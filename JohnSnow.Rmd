---
title: "JohnSnow"
author: "Joshua"
date: "11 septembre 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#install.packages("ggplot2")
#install.packages("ggmap")
#install.packages("sf")
#install.packages("rgdal")
#install.packages("leaflet")
#install.packages("readxl")
#install.packages("raster")
library(leaflet)
library(ggplot2)
library(ggmap)
require(rgdal) 
library(readxl)
library(raster)
```

## R Markdown

##Getting the data from the shapefiles
```{r}
unzip('SnowGIS_SHP.zip')
deaths <- rgdal::readOGR(dsn = "SnowGIS_SHP/", layer = "Cholera_Deaths")
deaths_f <- fortify(deaths@data)
deaths_f$Count <- as.numeric(as.character(deaths$Count)) #Converts the Count column to double
deaths_f$Id <- NULL #Deletes Id column
data_f <- as.data.frame(deaths@coords) #Creates an array with coordinates and counts of deaths
data_f$Count <- deaths$Count


pumps <- rgdal::readOGR(dsn = "SnowGIS_SHP/", layer = "Pumps")
pumps_f <- fortify(pumps@data)
pumps_test <- as.data.frame(pumps@coords)


rel <- raster("SnowGIS_SHP/OSMap.tif")
rel_spdf <- as(rel, "SpatialPixelsDataFrame")
rel <- as.data.frame(rel_spdf)
rel <- subset(rel, x > 529150 & x < 529800 & y > 180625 & y < 181375)

ggplot() +
  geom_raster(data = rel, aes_string(x = "x", y = "y", alpha = "OSMap")) +
  scale_alpha(name = "", range = c(0.6, 0), guide = F) +
  scale_colour_gradient(low = "#FF9020", high = "red") +
  geom_point(data = data_f, aes(x = coords.x1, y = coords.x2, size = Count, alpha = Count)) +
  geom_point(data = pumps_test, aes(x = coords.x1, y = coords.x2), colour = "black", size = 1)




```


