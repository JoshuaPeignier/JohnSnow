---
title: "JohnSnow"
author: "Joshua"
date: "11 septembre 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#install.packages("ggplot2")
#install.packages("ggmap")
#install.packages("sf")
#install.packages("rgdal")
#install.packages("leaflet")
#install.packages("readxl")
#install.packages("raster")
library(leaflet)
library(ggplot2)
library(ggmap)
require(rgdal) 
library(readxl)
library(raster)
```

##Getting the data from the shapefiles
First, unzip the data
```{r}
unzip('SnowGIS_SHP.zip')
```

Then get the number of deaths and their position
```{r}
deaths <- rgdal::readOGR(dsn = "SnowGIS_SHP/", layer = "Cholera_Deaths")
data_f <- as.data.frame(deaths@coords) #Creates an array with coordinates and counts of deaths
data_f$Count <- deaths$Count
```

Then the position of pumps
```{r}
pumps <- rgdal::readOGR(dsn = "SnowGIS_SHP/", layer = "Pumps")
pumps_f <- fortify(pumps@data)


pumps_test <- as.data.frame(pumps@coords)
```

Finally plot everything. The map is taken from an image.
```{r}
rel <- raster("SnowGIS_SHP/OSMap.tif")
rel_spdf <- as(rel, "SpatialPixelsDataFrame")
rel <- as.data.frame(rel_spdf)


ggplot() +
  geom_raster(data = rel, aes_string(x = "x", y = "y", alpha = "OSMap")) +
  scale_alpha(name = "", range = c(0.9, 0.1), guide = F) +
  scale_colour_gradient(low = "#DDCC00", high = "red") +
  geom_point(data = data_f, aes(x = coords.x1, y = coords.x2, colour = Count), size = 0.35) +
  geom_point(data = pumps_test, aes(x = coords.x1, y = coords.x2), colour = "black", size = 1)
```



Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
