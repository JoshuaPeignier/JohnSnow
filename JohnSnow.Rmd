---
title: "JohnSnow"
author: "Joshua"
date: "11 septembre 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#install.packages("ggplot2")
#install.packages("ggmap")
#install.packages("sf")
#install.packages("rgdal")
#install.packages("leaflet")
#install.packages("readxl")
#install.packages("raster")
library(leaflet)
library(ggplot2)
library(ggmap)
require(rgdal) 
library(readxl)
library(raster)
```

## R Markdown


##Getting a Map object.
```{r}
#test <- ggmap::get_stamenmap(bbox = c(left = 6.15, bottom = 49.10, right = 6.20, top = 49.15), zoom = 14, maptype="watercolor")
test <- ggmap::get_stamenmap(bbox = c(left = 6.15, bottom = 49.10, right = 6.20, top = 49.15), zoom = 14, maptype="watercolor")
ggmap::ggmap(test)
```


##Getting the data from the shapefiles
```{r}
unzip('SnowGIS_SHP.zip')
deaths <- rgdal::readOGR(dsn = "SnowGIS_SHP/", layer = "Cholera_Deaths")
deaths_f <- fortify(deaths@data)
deaths_f$Count <- as.numeric(as.character(deaths$Count)) #Converts the Count column to double
#deaths_f$Id <- as.numeric(as.character(deaths$Id)) #Converts the Id column to double
deaths_f$Id <- NULL #Deletes the Id column

data_f <- merge(deaths@coords, deaths_f) #Creates an array with coordinates and counts of deaths
lol <- pairs(data_f$coords.x1, data_f$coords.x2)
#data_f$Coords <- c(data_f$coords.x1, data_f$coords.x2)


rel <- raster("SnowGIS_SHP/OSMap.tif")
#plot(rel)
rel_spdf <- as(rel, "SpatialPixelsDataFrame")
rel <- as.data.frame(rel_spdf)


ggplot() +
  #Comment next line to only plot the points
  geom_raster(data = rel, aes_string(x = "x", y = "y", alpha = "OSMap")) +
  scale_alpha(name = "", range = c(0.6, 0), guide = F) +
  #Comment both following lines and uncomment first line of this block to only plot the map
  geom_count(data = deaths_f, aes(x = "x", y = "y"), colour = "black", size = 3) +
  #geom_point(data = deaths_f, aes(x = "x", y = "y"), colour = "black", size = 3)
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank()) +
  theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank()) +
  scale_fill_identity()



```



Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
